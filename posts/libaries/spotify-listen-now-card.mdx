---
title: "Spotify listening now card"
publishedAt: "2022-07-19"
excerpt: "NPM React component for generating Github card which shows profile and repository info"
englishOnly: "true"
technologies: ["SiReact", "SiNpm", "SiNextdotjs"]
author: "Bojan Jagetic"
inPreparation: false
tags: [{ slug: "", name: "libary" }, {slug: "", name: "npm module"}]
--- 

## Introduction
In this blog post, we'll explore a code snippet that demonstrates how to create a Spotify API wrapper using Node.js and the popular HTTP client library, Axios. The code allows you to fetch information about the currently playing track on Spotify and retrieve details such as the song title, artist, album, album cover image URL, and the Spotify song URL. Let's dive into the code and understand how it works.

## Code Explanation:
The code begins with disabling the camelcase linting rule using the comment /* eslint-disable camelcase */. This allows the code to use snake_case variable names without triggering any linting errors.

Next, the required modules, querystring and axios, are imported. querystring is used to stringify the request parameters, while axios is used to make HTTP requests to the Spotify API.

The code retrieves the required environment variables, namely SPOTIFY_CLIENT_ID, SPOTIFY_CLIENT_SECRET, and SPOTIFY_REFRESH_TOKEN, using destructuring assignment from the process.env object. These variables store sensitive information and should be kept secure.

The basic variable is then created by encoding the client_id and client_secret using Base64 encoding. It will be used for authentication when requesting an access token from Spotify.

Two constants, NOW_PLAYING_ENDPOINT and TOKEN_ENDPOINT, store the Spotify API endpoints for retrieving currently playing track information and obtaining access tokens, respectively.

The getAccessToken function is defined as an asynchronous function. It sends a POST request to the TOKEN_ENDPOINT with the necessary parameters, including the grant_type set to 'refresh_token' and the refresh_token obtained from the environment variables. The request includes the Authorization header with the encoded client_id and client_secret. The response data, which contains the access token, is returned.

The getNowPlaying function is another asynchronous function that retrieves the currently playing track information. It first calls getAccessToken to obtain the access token, then sends a GET request to the NOW_PLAYING_ENDPOINT with the access token included in the Authorization header. The response is returned.

The spotifyApi function is defined as an asynchronous function that takes two parameters, _ (unused) and res (response object). It calls getNowPlaying to get the currently playing track information. If the response status is 204 (no content) or an error occurs, or the currently playing type is not a track, it sends a JSON response indicating that nothing is currently playing. Otherwise, it extracts relevant data from the response and constructs a JSON object containing details about the currently playing track. Finally, it sends a JSON response with the constructed data.

The spotifyApi function is exported as the default export of the module.

## Conclusion:

In this blog post, we explored a code snippet that demonstrates how to create a Spotify API wrapper using Node.js and Axios. The code allows you to fetch information about the currently playing track on Spotify and retrieve details such as the song title, artist, album, album cover image URL, and the Spotify song URL. You can use this code as a starting point to build more advanced Spotify-related functionality in your Node.js applications. Feel free to modify and extend the code to suit your specific requirements. Happy coding!
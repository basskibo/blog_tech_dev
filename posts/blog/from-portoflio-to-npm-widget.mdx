---
title: "From Portfolio Widget to npm Package: Building a Spotify Now Playing Card"
publishedAt: "2026-01-20"
excerpt: "How I turned a custom Spotify widget from my portfolio into a reusable React + TypeScript npm package, including API setup, DX improvements and a small CLI."
englishOnly: "true"
banner: "bernd-dittrich-W1NsOMhU8hI-unsplash_ugoyld"
date: "January 20, 2026"
featuredImage: "https://images.unsplash.com/photo-1643208589893-ade2c3fbbcb4?q=80&w=1469&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
imageCreditUser: "Jr Korpa"
imageCreditUsername: "jrkorpa"
author: "Bojan Jagetic"
tags: [{ slug: "react", name: "react" }, { slug: "npm", name: "npm" }, { slug: "typescript", name: "typescript" }]
inPreparation: false
---

## Introduction

Na mom blogu sam dugo imao mali **Spotify ‚ÄúNow Playing‚Äù widget** u footeru.
Radio je posao, ali imao je dve mane:

- bio je ƒçvrsto vezan za projekat (Next.js API + Tailwind klase)
- nisam ga mogao jednostavno da podelim ili ponovo iskoristim

U ovom tekstu ƒáu proƒái kroz ceo proces:

- kako sam izdvojio widget u **ƒçistu React + TypeScript komponentu**
- kako sam napravio **API sloj za Spotify** koji mogu da koristim u vi≈°e projekata
- kako sam sve to upakovao u **npm paket** sa boljim DX‚Äëom (CSS, TypeScript tipovi, setup CLI)

Cilj je da na kraju mo≈æete da instalirate paket i uradite:

import { SpotifyCard } from "spotify-now-playing-card"
import "spotify-now-playing-card/dist/styles.css"

export default function Footer() {
  return <SpotifyCard apiUrl="/api/spotify" />
}

## API sloj ‚Äì bez ovoga nema muzike üéß

Prvi deo je standardni **Spotify API flow** sa refresh tokenom.

Za Next.js App Router (`app/api/spotify/route.ts`) izgleda ovako:

```typescript   
import { NextResponse } from "next/server"

const SPOTIFY_CLIENT_ID = process.env.SPOTIFY_CLIENT_ID
const SPOTIFY_CLIENT_SECRET = process.env.SPOTIFY_CLIENT_SECRET
const SPOTIFY_REFRESH_TOKEN = process.env.SPOTIFY_REFRESH_TOKEN

let accessToken: string | null = null
let tokenExpiry = 0

async function getAccessToken(): Promise<string> {
  if (accessToken && Date.now() < tokenExpiry) return accessToken

  if (!SPOTIFY_CLIENT_ID || !SPOTIFY_CLIENT_SECRET || !SPOTIFY_REFRESH_TOKEN) {
    throw new Error("Spotify credentials not configured")
  }

  const response = await fetch("https://accounts.spotify.com/api/token", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
      Authorization:
        "Basic " +
        Buffer.from(`${SPOTIFY_CLIENT_ID}:${SPOTIFY_CLIENT_SECRET}`).toString("base64"),
    },
    body: new URLSearchParams({
      grant_type: "refresh_token",
      refresh_token: SPOTIFY_REFRESH_TOKEN,
    }),
  })

  if (!response.ok) {
    throw new Error(`Failed to get access token: ${await response.text()}`)
  }

  const data = await response.json()
  accessToken = data.access_token
  tokenExpiry = Date.now() + 55 * 60 * 1000 // ~55 min

  return accessToken!
}
```



Zatim vraƒáamo **format koji paket oƒçekuje**:

```ts
export async function GET() {
  try {
    const token = await getAccessToken()

    const response = await fetch("https://api.spotify.com/v1/me/player/currently-playing", {
      headers: { Authorization: `Bearer ${token}` },
    })

    if (response.status === 204 || !response.ok) {
      return NextResponse.json({ isPlaying: false })
    }

    const data = await response.json()
    if (!data.item) return NextResponse.json({ isPlaying: false })

    return NextResponse.json({
      isPlaying: data.is_playing,
      title: data.item.name,
      artist: data.item.artists.map((a: any) => a.name).join(", "),
      album: data.item.album.name,
      albumImageUrl: data.item.album.images[0]?.url,
      songUrl: data.item.external_urls.spotify,
    })
  } catch (error) {
    console.error("Spotify API error:", error)
    return NextResponse.json({ isPlaying: false })
  }
}
```

Ovaj API endpoint je jedina zavisnost koju paket ima od va≈°eg projekta.

## React + TypeScript komponenta

U paketu komponenta izgleda upro≈°ƒáeno ovako:

```ts
export interface SpotifyCardProps {
  apiUrl?: string
  fallbackUrl?: string
  className?: string
  styles?: {
    container?: string
    link?: string
    image?: string
    title?: string
    artist?: string
    album?: string
    icon?: string
  }
  showAlbum?: boolean
  notPlayingText?: string
  refreshInterval?: number
}
```

```ts
const SpotifyCard: React.FC<SpotifyCardProps> = ({
  apiUrl = "/api/spotify",
  fallbackUrl = "https://open.spotify.com",
  className = "",
  styles = {},
  showAlbum = true,
  notPlayingText = "Currently not listening",
  refreshInterval = 30000,
  ...props
}) => {
  const { data, error } = useSWR<SpotifyData>(apiUrl, fetcher, {
    refreshInterval,
    revalidateOnFocus: true,
  })

  const defaultStyles = {
    container: "spotify-card-container",
    link: "spotify-card-link",
    image: "spotify-card-image",
    title: "spotify-card-title",
    artist: "spotify-card-artist",
    album: "spotify-card-album",
    icon: "spotify-card-icon",
  }

  const merged = { /* spajanje default + custom stilova */ }

  const isPlaying = data?.isPlaying
  const titleClass = isPlaying ? "spotify-card-title-gradient" : ""

  return (
    <div className={merged.container} {...props}>
      {/* slika ili Spotify logo */}
      {/* naslov, artist, album */}
      {/* mali Spotify logo u ƒáo≈°ku kad svira */}
    </div>
  )
}
```

Bitne odluke:

- **SWR** za ke≈°iranje + polling
- **TypeScript tipovi** (`SpotifyCardProps`, `SpotifyData`) izlaze u `dist/index.d.ts`
- **props za stilove** da bi ljudi mogli da ga prilagode Tailwind‚Äëom ili plain CSS‚Äëom

## CSS koji radi svuda (bez Tailwinda)

Originalni widget je bio ƒçist Tailwind. Za npm paket to nije po≈æeljno.

Re≈°enje: **mali CSS fajl u paketu**:

```css
.spotify-card-container {
  color: #94a3b8;
  border: 1px solid #262626;
  border-radius: 0.5rem;
  width: 100%;
  margin: 0.5rem 1.25rem;
}

/* ... image, title, album, icon, gradient naslov ... */
```

U Rollup konfiguraciji samo kopiram `src/styles.css` u `dist/styles.css`, a korisniku ka≈æem:

```ts
import "spotify-now-playing-card/dist/styles.css"
```

Ako ≈æeli≈° full Tailwind kontrolu ‚Äì jednostavno prosledi≈° svoje klase kroz `styles` prop.

## Pakovanje sa Rollup + TypeScript

Kratko, `rollup.config`:

```ts
export default {
  input: "src/index.ts",
  output: [
    { file: packageJson.main, format: "cjs", sourcemap: true, exports: "named" },
    { file: packageJson.module, format: "esm", sourcemap: true },
  ],
  plugins: [
    resolve({ browser: true }),
    commonjs(),
    typescript({
      tsconfig: "./tsconfig.json",
      declaration: true,
      declarationDir: "./dist",
    }),
    copy({ targets: [{ src: "src/styles.css", dest: "dist" }] }),
  ],
  external: ["react", "react-dom", "react/jsx-runtime", "axios", "swr", "react-icons/si"],
}
```

Ovo daje:

<HighlightBox>
- <Accent>dist/index.js</Accent> (CJS)
- <Accent>dist/index.esm.js</Accent> (ESM)
- <Accent>dist/index.d.ts</Accent> + <Accent>SpotifyCard.d.ts</Accent> (tipovi)
- <Accent>dist/styles.css</Accent>
</HighlightBox>


## Mali CLI za lak≈°i setup

Za bolji DX dodao sam **bin skriptu**:

```json
  "bin": {
  "spotify-card-setup": "bin/setup.js"
}
```

Korisnik onda mo≈æe da pokrene:

```shell
npx spotify-now-playing-card-setup
```

Skripta:

- pita za `clientId`, `clientSecret`, `refreshToken`
- kreira odgovarajuƒái API endpoint (App router ili Pages router)
- upisuje vrednosti u `.env.local`

Manje copy/paste‚Äëovanja, manje gre≈°aka.

## Kori≈°ƒáenje u aplikaciji

Minimalni primer u Next.js‚Äëu:

```ts
import { SpotifyCard } from "spotify-now-playing-card"
import "spotify-now-playing-card/dist/styles.css"

export default function Footer() {
  return (
    <footer>
      <SpotifyCard apiUrl="/api/spotify" />
    </footer>
  )
}
```

Sa prilagoƒëenim stilovima:

```ts

<SpotifyCard
  apiUrl="/api/spotify"
  styles={{
    container: "bg-gray-900/80 rounded-2xl border border-gray-700",
    title: "text-white text-lg font-semibold",
    artist: "text-gray-300",
  }}
  showAlbum
  notPlayingText="Currently off Spotify"
/>
```

## Conclusion

Ako imate neki **custom widget** u svom portfolio projektu, verovatno postoji jo≈° neko kome bi koristio.
Sa malo dodatnog truda oko API‚Äëja, DX‚Äëa i pakovanja, mo≈æete ga pretvoriti u pravi **npm paket** koji ≈æivi van jednog projekta.

Kod mene je to bila Spotify kartica ‚Äì kod vas mo≈æe biti bilo ≈°ta: GitHub kartica, Dev.to feed, custom loader‚Ä¶
